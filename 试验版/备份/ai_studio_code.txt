{
  "cjcx.py": "# -*- coding: utf-8 -*-\nfrom fastapi import FastAPI, HTTPException\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom pydantic import BaseModel\nimport requests\nfrom bs4 import BeautifulSoup\nfrom Crypto.Cipher import AES\nfrom Crypto.Util.Padding import pad\nimport base64\nimport uuid\nimport random\nimport string\nimport time\nimport re\n\napp = FastAPI(title=\"HBUT æ•™åŠ¡å°ç¨‹åºåç«¯\")\n\n# ================= é…ç½®åŒºåŸŸ =================\n\n# å…è®¸è·¨åŸŸ\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# å†…å­˜æ•°æ®åº“ (ç”Ÿäº§ç¯å¢ƒè¯·æ¢ Redis)\nFAKE_REDIS = {}\n\n# URL é…ç½®\nLOGIN_URL = \"https://auth.hbut.edu.cn/authserver/login\"\nCAPTCHA_URL = \"https://auth.hbut.edu.cn/authserver/getCaptcha.htl\"\nJW_HOME_URL = \"https://hbut.jw.chaoxing.com/admin/login\"\n\n# [å…³é”®] è¯¾è¡¨HTMLé¡µé¢ï¼Œç”¨äºæŠ“å– xhid\nTIMETABLE_PAGE_URL = \"https://hbut.jw.chaoxing.com/admin/pkgl/xskb/xskbSy\"\n# è¯¾è¡¨æ•°æ®æ¥å£\nTIMETABLE_API_URL = \"https://hbut.jw.chaoxing.com/admin/pkgl/xskb/sdpkkbList\"\n# æˆç»©æ¥å£\nGRADE_API_URL = \"https://hbut.jw.chaoxing.com/admin/xsd/xsdcjcx/xsdQueryXscjList\"\n\nHEADERS = {\n    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",\n    \"Referer\": LOGIN_URL\n}\n\n# è¯¾ç¨‹æ€§è´¨æ˜ å°„\nKCXZ_MAP = {\n    \"44\": \"ä¸“ä¸šå¿…ä¿®\", \"11\": \"é€šè¯†å¿…ä¿®\", \"12\": \"é€šè¯†é€‰ä¿®\",\n    \"31\": \"å­¦ç§‘åŸºç¡€\", \"40\": \"ä¸“ä¸šæ ¸å¿ƒ\", \"45\": \"ä¸“ä¸šé€‰ä¿®\",\n    \"50\": \"åŸºç¡€å®è·µ\", \"51\": \"ä¸“ä¸šå®è·µ\", \"52\": \"ç»¼åˆå®è·µ\",\n    \"99\": \"å…¬å…±é€‰ä¿®\", \"98\": \"é‡ä¿®\", \"16\": \"é™é€‰\"\n}\n\n# ================= æ•°æ®æ¨¡å‹ =================\n\nclass LoginRequest(BaseModel):\n    token: str\n    username: str\n    password: str\n    captcha: str\n\nclass TokenRequest(BaseModel):\n    token: str\n\nclass TimetableRequest(BaseModel):\n    token: str\n    xnxq: str = \"2025-2026-1\"  # é»˜è®¤ä¸ºå½“å‰å­¦æœŸï¼Œå¯ç”±å‰ç«¯ä¼ å…¥\n\n# ================= å·¥å…·å‡½æ•° =================\n\ndef encrypt_password(password: str, salt: str) -> str:\n    try:\n        random_str = ''.join(random.choices(string.ascii_letters + string.digits, k=64))\n        text = random_str + password\n        key = salt.encode('utf-8')\n        iv = ''.join(random.choices(string.ascii_letters + string.digits, k=16)).encode('utf-8')\n        cipher = AES.new(key, AES.MODE_CBC, iv)\n        return base64.b64encode(cipher.encrypt(pad(text.encode('utf-8'), AES.block_size))).decode('utf-8')\n    except Exception as e:\n        print(f\"åŠ å¯†å¤±è´¥: {e}\")\n        return None\n\ndef strip_html(text: str) -> str:\n    if not text: return \"\"\n    try:\n        return BeautifulSoup(text, \"html.parser\").get_text(strip=True)\n    except:\n        return text\n\n# ================= API æ¥å£ =================\n\n@app.get(\"/api/captcha\")\ndef get_captcha():\n    session = requests.Session()\n    session.headers.update(HEADERS)\n    try:\n        resp = session.get(LOGIN_URL, timeout=10)\n        soup = BeautifulSoup(resp.text, 'html.parser')\n        \n        execution = soup.find('input', {'name': 'execution'})['value']\n        salt = soup.find('input', {'id': 'pwdEncryptSalt'})['value']\n        lt_tag = soup.find('input', {'name': 'lt'})\n        lt = lt_tag['value'] if lt_tag else \"\"\n\n        timestamp = int(time.time() * 1000)\n        captcha_resp = session.get(f\"{CAPTCHA_URL}?{timestamp}\", timeout=5)\n        b64_img = base64.b64encode(captcha_resp.content).decode('utf-8')\n        \n        temp_token = str(uuid.uuid4())\n        FAKE_REDIS[f\"session:{temp_token}\"] = {\n            \"cookies\": session.cookies.get_dict(),\n            \"execution\": execution, \"salt\": salt, \"lt\": lt\n        }\n        return {\"code\": 200, \"data\": {\"token\": temp_token, \"image\": f\"data:image/jpeg;base64,{b64_img}\"}}\n    except Exception as e:\n        return {\"code\": 500, \"msg\": f\"éªŒè¯ç è·å–å¤±è´¥: {str(e)}\"}\n\n@app.post(\"/api/login\")\ndef login(req: LoginRequest):\n    raw_data = FAKE_REDIS.get(f\"session:{req.token}\")\n    if not raw_data: return {\"code\": 400, \"msg\": \"éªŒè¯ç è¿‡æœŸ\"}\n    \n    session = requests.Session()\n    session.headers.update(HEADERS)\n    session.cookies.update(raw_data['cookies'])\n    \n    pwd = encrypt_password(req.password, raw_data['salt'])\n    payload = {\n        \"username\": req.username, \"password\": pwd, \"captcha\": req.captcha,\n        \"_eventId\": \"submit\", \"cllt\": \"userNameLogin\", \"dllt\": \"generalLogin\",\n        \"lt\": raw_data['lt'], \"execution\": raw_data['execution']\n    }\n    \n    try:\n        # 1. ç™»å½• AuthServer\n        login_resp = session.post(LOGIN_URL, data=payload, allow_redirects=False, timeout=15)\n        \n        if login_resp.status_code == 302:\n            # 2. æ¿€æ´» JW Cookie\n            redirect_url = login_resp.headers.get(\"Location\")\n            session.get(redirect_url, allow_redirects=True)\n            session.get(JW_HOME_URL)\n            \n            # 3. [æ ¸å¿ƒ] è‡ªåŠ¨æŠ“å– xhid\n            print(\"æ­£åœ¨è‡ªåŠ¨æå– xhid...\")\n            xhid = \"\"\n            try:\n                tb_page = session.get(TIMETABLE_PAGE_URL, timeout=10)\n                # æ­£åˆ™æŸ¥æ‰¾ value=\"xxxx...\"\n                match = re.search(r'name=\"xhid\"[^>]*value=\"([^\"]+)\"', tb_page.text)\n                if match:\n                    xhid = match.group(1)\n                    print(f\"æˆåŠŸæå– xhid: {xhid[:15]}...\")\n                else:\n                    print(\"æœªåœ¨é¡µé¢æ‰¾åˆ° xhidï¼Œå°è¯•å¤‡ç”¨æ­£åˆ™...\")\n                    # å¤‡ç”¨æ­£åˆ™ï¼šæœ‰æ—¶å€™ id å’Œ name é¡ºåºä¸åŒ\n                    match2 = re.search(r'id=\"xhid\"[^>]*value=\"([^\"]+)\"', tb_page.text)\n                    if match2: xhid = match2.group(1)\n            except Exception as e:\n                print(f\"æå– xhid å¼‚å¸¸: {e}\")\n            \n            if not xhid:\n                return {\"code\": 500, \"msg\": \"ç™»å½•æˆåŠŸï¼Œä½†æ— æ³•è·å–è¯¾è¡¨æƒé™ID (xhid)\"}\n\n            # 4. å­˜å‚¨ç”¨æˆ·å‡­è¯\n            user_token = str(uuid.uuid4())\n            FAKE_REDIS[f\"user:{user_token}\"] = {\n                \"cookies\": session.cookies.get_dict(),\n                \"xhid\": xhid,\n                \"stu_id\": req.username\n            }\n            del FAKE_REDIS[f\"session:{req.token}\"]\n            return {\"code\": 200, \"msg\": \"ç™»å½•æˆåŠŸ\", \"user_token\": user_token}\n        \n        else:\n            return {\"code\": 401, \"msg\": \"è´¦å·æˆ–å¯†ç é”™è¯¯\"}\n    except Exception as e:\n        return {\"code\": 500, \"msg\": f\"ç™»å½•å¼‚å¸¸: {str(e)}\"}\n\n@app.post(\"/api/grades\")\ndef query_grades(req: TokenRequest):\n    user_data = FAKE_REDIS.get(f\"user:{req.token}\")\n    if not user_data: return {\"code\": 401, \"msg\": \"è¯·é‡æ–°ç™»å½•\"}\n    \n    session = requests.Session()\n    session.headers.update(HEADERS)\n    session.cookies.update(user_data['cookies'])\n    \n    payload = {\n        \"fxbz\": \"0\", \"gridtype\": \"jqgrid\", \"page.pn\": \"1\", \"page.size\": \"500\",\n        \"sort\": \"xnxq\", \"order\": \"desc\",\n        \"queryFields\": \"id,xnxq,kcmc,xf,kcxz,cjfxms,zhcj,xdxz\"\n    }\n    try:\n        resp = session.post(GRADE_API_URL, data=payload, timeout=10)\n        if \"text/html\" in resp.headers.get(\"Content-Type\", \"\"):\n            return {\"code\": 401, \"msg\": \"ä¼šè¯è¿‡æœŸ\"}\n            \n        res_list = resp.json().get(\"results\", [])\n        data = []\n        for item in res_list:\n            data.append({\n                \"semester\": item.get(\"xnxq\"),\n                \"name\": item.get(\"kcmc\"),\n                \"credit\": item.get(\"xf\"),\n                \"score\": item.get(\"zhcj\"),\n                \"type\": KCXZ_MAP.get(str(item.get(\"kcxz\")), \"å…¶ä»–\"),\n                \"is_retake\": str(item.get(\"xdxz\")) == \"2\"\n            })\n        return {\"code\": 200, \"data\": data}\n    except Exception as e:\n        return {\"code\": 500, \"msg\": str(e)}\n\n@app.post(\"/api/timetable\")\ndef query_timetable(req: TimetableRequest):\n    user_data = FAKE_REDIS.get(f\"user:{req.token}\")\n    if not user_data: return {\"code\": 401, \"msg\": \"è¯·é‡æ–°ç™»å½•\"}\n    \n    xhid = user_data.get(\"xhid\")\n    if not xhid: return {\"code\": 403, \"msg\": \"ç¼ºå°‘ xhidï¼Œè¯·é‡æ–°ç™»å½•\"}\n\n    session = requests.Session()\n    session.headers.update(HEADERS)\n    session.cookies.update(user_data['cookies'])\n    \n    # æ„é€ è¯·æ±‚å‚æ•°\n    params = {\n        \"xnxq\": req.xnxq,\n        \"xhid\": xhid,      # ä½¿ç”¨è‡ªåŠ¨æŠ“å–çš„ xhid\n        \"xqdm\": \"1\",\n        \"xskbxslx\": \"0\"\n    }\n    \n    try:\n        resp = session.get(TIMETABLE_API_URL, params=params, timeout=10)\n        if \"text/html\" in resp.headers.get(\"Content-Type\", \"\"):\n             return {\"code\": 401, \"msg\": \"ä¼šè¯è¿‡æœŸ\"}\n             \n        json_data = resp.json()\n        if json_data.get(\"ret\") != 0:\n             return {\"code\": 500, \"msg\": json_data.get(\"msg\", \"æ¥å£è¿”å›é”™è¯¯\")}\n             \n        raw_list = json_data.get(\"data\", [])\n        clean_list = []\n        \n        for item in raw_list:\n            # æ•°æ®æ¸…æ´—ï¼šå»é™¤HTMLæ ‡ç­¾\n            clean_list.append({\n                \"name\": strip_html(item.get(\"kcmc\")),   # è¯¾ç¨‹å\n                \"room\": strip_html(item.get(\"croommc\")),# æ•™å®¤\n                \"teacher\": strip_html(item.get(\"tmc\")), # æ•™å¸ˆ\n                \"weeks_desc\": item.get(\"zc\"),           # å‘¨æ¬¡æè¿° (1-16)\n                \"weeks_list\": item.get(\"zcstr\", \"\"),    # å‘¨æ¬¡åˆ—è¡¨ (1,2,3...)\n                \"day\": item.get(\"xingqi\"),              # æ˜ŸæœŸå‡  (1-7)\n                \"start\": item.get(\"djc\"),               # å¼€å§‹èŠ‚æ¬¡\n                \"step\": item.get(\"djs\", 1),             # æŒç»­èŠ‚æ¬¡\n                \"credit\": item.get(\"xf\")\n            })\n            \n        return {\"code\": 200, \"data\": clean_list, \"semester\": req.xnxq}\n        \n    except Exception as e:\n        return {\"code\": 500, \"msg\": f\"è¯¾è¡¨è·å–å¤±è´¥: {str(e)}\"}\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)",
  "index.html": "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>HBUT æ•™åŠ¡å°ç¨‹åºè°ƒè¯•ç»ˆç«¯</title>\n    <style>\n        :root { --primary: #007bff; --bg: #f4f7f6; }\n        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }\n        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }\n        h2 { border-bottom: 2px solid var(--primary); padding-bottom: 10px; color: var(--primary); }\n        .panel { display: none; padding: 20px; animation: fadeIn 0.3s; }\n        .panel.active { display: block; }\n        .form-group { margin-bottom: 15px; }\n        label { display: block; font-weight: 600; margin-bottom: 5px; }\n        input, button, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }\n        button { background: var(--primary); color: #fff; border: none; cursor: pointer; font-size: 16px; margin-top: 10px; }\n        button:hover { background: #0056b3; }\n        button:disabled { background: #ccc; cursor: not-allowed; }\n        .captcha-row { display: flex; gap: 10px; }\n        #captcha-img { height: 42px; cursor: pointer; border: 1px solid #ddd; border-radius: 5px; }\n        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }\n        .tab-btn { flex: 1; padding: 8px; background: #eee; border: none; color: #666; }\n        .tab-btn.active { background: var(--primary); color: #fff; font-weight: bold; }\n        \n        /* è¡¨æ ¼æ ·å¼ */\n        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }\n        th, td { padding: 10px; border: 1px solid #eee; text-align: left; }\n        th { background: #f8f9fa; font-weight: 600; color: #555; }\n        tr:nth-child(even) { background: #fcfcfc; }\n        .pass { color: green; font-weight: bold; }\n        .fail { color: red; font-weight: bold; }\n        \n        /* è¯¾è¡¨ç½‘æ ¼ç®€å•å±•ç¤º */\n        .kb-card { background: #e3f2fd; border-left: 4px solid var(--primary); padding: 8px; margin-bottom: 5px; border-radius: 4px; font-size: 13px; }\n        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n    </style>\n</head>\n<body>\n\n<div class=\"container\">\n    <h2>ğŸš€ HBUT æ•™åŠ¡æ•°æ®æ¥å£è°ƒè¯•</h2>\n\n    <!-- ç™»å½•é¢æ¿ -->\n    <div id=\"panel-login\" class=\"panel active\">\n        <h3>1. ç»Ÿä¸€èº«ä»½è®¤è¯</h3>\n        <div class=\"form-group\">\n            <label>å­¦å·</label>\n            <input type=\"text\" id=\"u_name\" placeholder=\"è¯·è¾“å…¥å­¦å·\">\n        </div>\n        <div class=\"form-group\">\n            <label>å¯†ç </label>\n            <input type=\"password\" id=\"u_pass\" placeholder=\"è¯·è¾“å…¥å¯†ç \">\n        </div>\n        <div class=\"form-group\">\n            <label>éªŒè¯ç </label>\n            <div class=\"captcha-row\">\n                <input type=\"text\" id=\"u_captcha\" placeholder=\"4ä½éªŒè¯ç \">\n                <img id=\"captcha-img\" src=\"\" onclick=\"loadCaptcha()\" title=\"ç‚¹å‡»åˆ·æ–°\">\n            </div>\n        </div>\n        <button onclick=\"doLogin()\" id=\"btn-login\">ç™»å½•ç³»ç»Ÿ</button>\n        <p id=\"login-msg\" style=\"color:red; margin-top:10px;\"></p>\n    </div>\n\n    <!-- åŠŸèƒ½åŒº -->\n    <div id=\"panel-func\" class=\"panel\">\n        <div class=\"tabs\">\n            <button class=\"tab-btn active\" onclick=\"switchTab('grade')\">æˆ‘çš„æˆç»©</button>\n            <button class=\"tab-btn\" onclick=\"switchTab('timetable')\">å­¦æœŸè¯¾è¡¨</button>\n        </div>\n\n        <!-- æˆç»©æ¨¡å— -->\n        <div id=\"view-grade\">\n            <button onclick=\"fetchGrades()\">ğŸ”„ åˆ·æ–°æˆç»©åˆ—è¡¨</button>\n            <div style=\"overflow-x: auto;\">\n                <table id=\"tb-grades\">\n                    <thead><tr><th>å­¦æœŸ</th><th>è¯¾ç¨‹å</th><th>å­¦åˆ†</th><th>æ€§è´¨</th><th>æˆç»©</th></tr></thead>\n                    <tbody></tbody>\n                </table>\n            </div>\n        </div>\n\n        <!-- è¯¾è¡¨æ¨¡å— -->\n        <div id=\"view-timetable\" style=\"display:none;\">\n            <div class=\"form-group\">\n                <label>é€‰æ‹©å­¦æœŸ (é»˜è®¤å½“å‰)</label>\n                <input type=\"text\" id=\"kb-xnxq\" value=\"2025-2026-1\" placeholder=\"ä¾‹å¦‚ 2024-2025-1\">\n            </div>\n            <button onclick=\"fetchTimetable()\">ğŸ“… æŸ¥è¯¢è¯¾è¡¨</button>\n            <p id=\"kb-msg\" style=\"color:blue; font-size:13px; margin-top:5px;\"></p>\n            \n            <div style=\"overflow-x: auto; margin-top:10px;\">\n                <table id=\"tb-timetable\">\n                    <thead><tr><th>å‘¨å‡ </th><th>èŠ‚æ¬¡</th><th>è¯¾ç¨‹ä¿¡æ¯</th></tr></thead>\n                    <tbody></tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script>\n    const API = \"http://127.0.0.1:8000/api\";\n    let tempToken = \"\";\n    let userToken = \"\";\n\n    // åˆå§‹åŒ–\n    window.onload = loadCaptcha;\n\n    // 1. è·å–éªŒè¯ç \n    async function loadCaptcha() {\n        try {\n            const res = await fetch(`${API}/captcha`);\n            const json = await res.json();\n            document.getElementById('captcha-img').src = json.data.image;\n            tempToken = json.data.token;\n        } catch (e) { alert(\"æ— æ³•è¿æ¥åç«¯æœåŠ¡\"); }\n    }\n\n    // 2. æ‰§è¡Œç™»å½•\n    async function doLogin() {\n        const u = document.getElementById('u_name').value;\n        const p = document.getElementById('u_pass').value;\n        const c = document.getElementById('u_captcha').value;\n        const btn = document.getElementById('btn-login');\n        const msg = document.getElementById('login-msg');\n\n        if(!u || !p || !c) return alert(\"è¯·å¡«å†™å®Œæ•´ä¿¡æ¯\");\n\n        btn.disabled = true;\n        btn.innerText = \"ç™»å½•ä¸­ (æ­£åœ¨æŠ“å–xhid)...\";\n        msg.innerText = \"\";\n\n        try {\n            const res = await fetch(`${API}/login`, {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({ token: tempToken, username: u, password: p, captcha: c })\n            });\n            const json = await res.json();\n            \n            if(json.code === 200) {\n                userToken = json.user_token;\n                document.getElementById('panel-login').classList.remove('active');\n                document.getElementById('panel-func').classList.add('active');\n                fetchGrades(); // è‡ªåŠ¨æŸ¥ä¸€æ¬¡æˆç»©\n            } else {\n                msg.innerText = json.msg;\n                loadCaptcha(); // åˆ·æ–°éªŒè¯ç \n            }\n        } catch (e) {\n            msg.innerText = \"è¯·æ±‚å‡ºé”™: \" + e.message;\n        } finally {\n            btn.disabled = false;\n            btn.innerText = \"ç™»å½•ç³»ç»Ÿ\";\n        }\n    }\n\n    // 3. æŸ¥æˆç»©\n    async function fetchGrades() {\n        const tbody = document.querySelector('#tb-grades tbody');\n        tbody.innerHTML = '<tr><td colspan=\"5\">åŠ è½½ä¸­...</td></tr>';\n        \n        try {\n            const res = await fetch(`${API}/grades`, {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({ token: userToken })\n            });\n            const json = await res.json();\n            tbody.innerHTML = '';\n            \n            if(json.code === 200) {\n                json.data.forEach(item => {\n                    const scoreClass = (parseFloat(item.score)>=60 || item.score==='åˆæ ¼') ? 'pass' : 'fail';\n                    tbody.innerHTML += `\n                        <tr>\n                            <td>${item.semester}</td>\n                            <td>${item.is_retake?'<span style=\"color:red\">[é‡ä¿®]</span> ':''}${item.name}</td>\n                            <td>${item.credit}</td>\n                            <td>${item.type}</td>\n                            <td class=\"${scoreClass}\">${item.score}</td>\n                        </tr>`;\n                });\n            } else {\n                alert(json.msg);\n            }\n        } catch(e) { alert(\"æˆç»©è·å–å¤±è´¥\"); }\n    }\n\n    // 4. æŸ¥è¯¾è¡¨\n    async function fetchTimetable() {\n        const xnxq = document.getElementById('kb-xnxq').value || \"2025-2026-1\";\n        const tbody = document.querySelector('#tb-timetable tbody');\n        const msg = document.getElementById('kb-msg');\n        tbody.innerHTML = '<tr><td colspan=\"3\">æŸ¥è¯¢ä¸­...</td></tr>';\n        msg.innerText = \"\";\n\n        try {\n            const res = await fetch(`${API}/timetable`, {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({ token: userToken, xnxq: xnxq })\n            });\n            const json = await res.json();\n            tbody.innerHTML = '';\n            \n            if(json.code === 200) {\n                // æ’åºï¼šå‘¨å‡  -> èŠ‚æ¬¡\n                const sorted = json.data.sort((a,b) => (a.day - b.day) || (a.start - b.start));\n                \n                sorted.forEach(item => {\n                    tbody.innerHTML += `\n                        <tr>\n                            <td>å‘¨${\"ä¸€äºŒä¸‰å››äº”å…­æ—¥\"[item.day-1] || item.day}</td>\n                            <td>${item.start}-${parseInt(item.start)+parseInt(item.step)-1}èŠ‚</td>\n                            <td>\n                                <div class=\"kb-card\">\n                                    <strong>${item.name}</strong><br>\n                                    ğŸ  ${item.room} | ğŸ‘¨â€ğŸ« ${item.teacher}<br>\n                                    ğŸ“… ${item.weeks_desc}å‘¨\n                                </div>\n                            </td>\n                        </tr>`;\n                });\n                msg.innerText = `æˆåŠŸè·å– ${json.data.length} é—¨è¯¾ç¨‹`;\n            } else {\n                tbody.innerHTML = `<tr><td colspan=\"3\" style=\"color:red\">${json.msg}</td></tr>`;\n            }\n        } catch(e) { alert(\"è¯¾è¡¨è¯·æ±‚é”™è¯¯\"); }\n    }\n\n    // åˆ‡æ¢ Tab\n    function switchTab(tab) {\n        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));\n        event.target.classList.add('active');\n        document.getElementById('view-grade').style.display = tab==='grade'?'block':'none';\n        document.getElementById('view-timetable').style.display = tab==='timetable'?'block':'none';\n    }\n</script>\n\n</body>\n</html>"
}